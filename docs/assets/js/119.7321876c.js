(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{657:function(e,t,o){"use strict";o.r(t);var a=o(13),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"hybrid-mode-guide-to-the-redstone-update-and-the-merge"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#hybrid-mode-guide-to-the-redstone-update-and-the-merge"}},[e._v("#")]),e._v(" [Hybrid Mode] Guide to the Redstone Update and the Merge")]),e._v(" "),o("p",[e._v("This guide will cover everything you need to know in order to prepare your node for the Redstone Update and The Merge if you are using "),o("strong",[e._v("Hybrid Mode")]),e._v(".")]),e._v(" "),o("h2",{attrs:{id:"things-to-do-before-upgrading-to-v1-5-0"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#things-to-do-before-upgrading-to-v1-5-0"}},[e._v("#")]),e._v(" Things to Do Before Upgrading to v1.5.0")]),e._v(" "),o("p",[e._v("Before upgrading to v1.5.0 and higher of the Smartnode, please go through the following checklist to make sure you're prepared:")]),e._v(" "),o("h3",{attrs:{id:"switch-to-a-full-execution-client"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#switch-to-a-full-execution-client"}},[e._v("#")]),e._v(" Switch to a Full Execution Client")]),e._v(" "),o("p",[e._v("The Merge requires you to run your own Execution client, so you won't be able to use remote providers like Infura or Pocket anymore.")]),e._v(" "),o("p",[e._v("Because of this change, if you're currently using a light Execution client, you should switch to a full client while you're still on v1.4, let it sync to completion, and then upgrade to v1.5.")]),e._v(" "),o("h3",{attrs:{id:"ensure-the-ec-and-cc-are-both-externally-managed"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ensure-the-ec-and-cc-are-both-externally-managed"}},[e._v("#")]),e._v(" Ensure the EC and CC are Both Externally Managed")]),e._v(" "),o("p",[e._v("Previous versions of the Smartnode stack allowed you to have one client locally managed, and the other externally managed.\nFor example, you could have an Execution client that the Smartnode manages and connect it to a Consensus client that you manage externaly.")]),e._v(" "),o("p",[e._v("Starting with v1.5, this configuration is no longer supported.\nYou'll have to switch to either a locally managed Execution and Consensus client (also known as "),o("RouterLink",{attrs:{to:"/guides/redstone/docker-migration.html"}},[e._v("Docker Mode")]),e._v("), or set up both an Execution and a Consensus client that you manage on your own.")],1),e._v(" "),o("div",{staticClass:"custom-block tip"},[o("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),o("p",[e._v("If you are interested in letting the Smartnode maintain its own Execution and Consensus client but want to keep control over your own Validator client (e.g., if you have your own solo staking validator keys attached to it), you may want to consider "),o("RouterLink",{attrs:{to:"/guides/node/advanced-config.html#allowing-external-validator-clients-to-connect-to-the-smartnode"}},[e._v("Reverse Hybrid Mode")]),e._v(" which does exactly this!")],1)]),e._v(" "),o("h3",{attrs:{id:"set-up-the-engine-api"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#set-up-the-engine-api"}},[e._v("#")]),e._v(" Set Up the Engine API")]),e._v(" "),o("p",[e._v("The Merge changes the way your Execution client talks to your Consensus client.\nInstead of using the old HTTP or Websocket based RPC system, The Merge requires a new system exposed by your Execution client called the Engine API.")]),e._v(" "),o("p",[e._v("This is a special connection that lets the Consensus client replace the old Proof-of-Work mining system with Proof-of-Stake; it's the heart of The Merge.\nIt's also "),o("strong",[e._v("authenticated")]),e._v(" with a secret token, so only your Consensus client can connect to your Execution client - nothing else can.")]),e._v(" "),o("p",[e._v("As you manage your own Execution and Consensus clients, you'll need to set up the Engine API manually.\nHow to do it depends entirely on which clients you're running.")]),e._v(" "),o("p",[e._v("CoinCashew has "),o("a",{attrs:{href:"https://www.coincashew.com/coins/overview-eth/ethereum-merge-upgrade-checklist-for-home-stakers-and-validators",target:"_blank",rel:"noopener noreferrer"}},[e._v("a great and concise guide"),o("OutboundLink")],1),e._v(" on how to set up the Engine API on your Execution and Consensus clients.\nGive that a look, and test the new configuration out by making sure it still attests properly before upgrading.")]),e._v(" "),o("p",[e._v("As always, Rocket Pool will manage its own Validator client so you don't need to worry about manually modifying it.")]),e._v(" "),o("h2",{attrs:{id:"upgrading-to-v1-5-0"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#upgrading-to-v1-5-0"}},[e._v("#")]),e._v(" Upgrading to v1.5.0")]),e._v(" "),o("p",[e._v("Upgrading the Smartnode stack to v1.5.0 is no different than any other upgrade.\nSimply follow "),o("RouterLink",{attrs:{to:"/guides/node/updates.html#updating-the-smartnode-stack"}},[e._v("the normal directions here")]),e._v(".")],1),e._v(" "),o("h2",{attrs:{id:"things-the-smartnode-handles-automatically"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#things-the-smartnode-handles-automatically"}},[e._v("#")]),e._v(" Things the Smartnode Handles Automatically")]),e._v(" "),o("p",[e._v("In Hybrid mode, the Smartnode will take care of some of the changes needed to support Redstone automatically once you update to v1.5.0, but you will need to handle others manually in Hybrid Mode.")]),e._v(" "),o("p",[e._v("Here's a brief list of what it will do for you without any manual intervention:")]),e._v(" "),o("h3",{attrs:{id:"your-fee-recipient"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#your-fee-recipient"}},[e._v("#")]),e._v(" Your Fee Recipient")]),e._v(" "),o("p",[e._v("The "),o("strong",[e._v("fee recipient")]),e._v(" is the address on the Execution layer (eth1) chain that will receive all of the priority fees for blocks you propose.\nIt is a setting provided to your Validator client when it first starts.")]),e._v(" "),o("p",[e._v("The Smartnode will handle setting it up to the correct address on the Validator client it manages when you upgrade to v1.5, and will constantly check to make sure you're using the correct one so you don't get "),o("a",{attrs:{href:"https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("penalized accidentally"),o("OutboundLink")],1),e._v(".")]),e._v(" "),o("p",[e._v("If you opted into the "),o("RouterLink",{attrs:{to:"/guides/redstone/whats-new.html#smoothing-pool"}},[e._v("Smoothing Pool")]),e._v(", it will make that your fee recipient.\nIf you didn't, it will make your "),o("RouterLink",{attrs:{to:"/guides/redstone/whats-new.html#fee-recipients-and-your-distributor"}},[e._v("fee distributor contract")]),e._v(" the fee recipient.")],1),e._v(" "),o("h2",{attrs:{id:"things-you-should-do-after-upgrading"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#things-you-should-do-after-upgrading"}},[e._v("#")]),e._v(" Things You Should Do After Upgrading")]),e._v(" "),o("p",[e._v("While the Smartnode handles most of the changes for you, there are a few additional things you should do manually:")]),e._v(" "),o("h3",{attrs:{id:"ensure-a-successful-upgrade"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#ensure-a-successful-upgrade"}},[e._v("#")]),e._v(" Ensure a Successful Upgrade")]),e._v(" "),o("p",[e._v("The first thing to do is ensure that your node is working correctly.\nConsider taking the following steps:")]),e._v(" "),o("ul",[o("li",[e._v("Check the logs for errors with "),o("code",[e._v("rocketpool service logs validator")]),e._v(" and "),o("code",[e._v("rocketpool service logs node")]),e._v(".")]),e._v(" "),o("li",[e._v("Confirm with a Block Explorer (such as your Grafana dashboard and "),o("a",{attrs:{href:"https://beaconcha.in",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://beaconcha.in"),o("OutboundLink")],1),e._v(") that you are still attesting properly\n"),o("ul",[o("li",[e._v("Remember that if you have Doppelganger protection enabled, you will miss a few attestations after the restart. This is normal!")])])])]),e._v(" "),o("h3",{attrs:{id:"set-up-mev-boost"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#set-up-mev-boost"}},[e._v("#")]),e._v(" Set Up MEV-Boost")]),e._v(" "),o("p",[o("a",{attrs:{href:"https://boost.flashbots.net/",target:"_blank",rel:"noopener noreferrer"}},[e._v("MEV-boost"),o("OutboundLink")],1),e._v(" is the system Flashbots provides to give MEV rewards to Proof-of-Stake validators after The Merge.")]),e._v(" "),o("p",[o("strong",[e._v("Rocket Pool requires all nodes to use it to maximize their returns and thus keep the protocol competitive with other staking services.")])]),e._v(" "),o("p",[e._v("You will need to make some adjustments to your Beacon Node / Consensus client to connect it to MEV-boost.")]),e._v(" "),o("p",[e._v("MEV-boost is currently not available on Prater or Mainnet, so you do not need to set it up at this time.\nOf course, you will not be penalized for not using it during this transition period.")]),e._v(" "),o("p",[e._v("Once it becomes available, we will announce a date at which it must be installed and connected to your node.\nFlashbots will provide instructions you can follow at that time, and we will link to them here.")]),e._v(" "),o("div",{staticClass:"custom-block danger"},[o("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),o("p",[e._v("Once we make the announcement that MEV-boost must be enabled by all node operators, you must ensure you have it properly installed and configured with your Beacon Node!")]),e._v(" "),o("p",[e._v("Not doing so will result in your minipool being "),o("a",{attrs:{href:"https://github.com/rocket-pool/rocketpool-research/blob/master/Penalties/penalty-system.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("penalized"),o("OutboundLink")],1),e._v(".")])]),e._v(" "),o("h3",{attrs:{id:"set-up-a-fallback-node"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#set-up-a-fallback-node"}},[e._v("#")]),e._v(" Set Up a Fallback Node")]),e._v(" "),o("p",[e._v("Because The Merge is not compatible with remote providers like Infura and Pocket, you'll lose the ability to use them as fallback Execution clients when your primary goes offline.")]),e._v(" "),o("p",[e._v("The Smartnode still has the ability to provide a fallback Execution client (and now a fallback Consensus client as well), but you will now need to use Execution and Consensus clients that you control.")]),e._v(" "),o("p",[e._v("For more information on setting up a fallback node, see the "),o("RouterLink",{attrs:{to:"/guides/node/fallback.html"}},[e._v("Fallback node guide")]),e._v(".")],1),e._v(" "),o("h3",{attrs:{id:"initialize-your-fee-distributor"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#initialize-your-fee-distributor"}},[e._v("#")]),e._v(" Initialize your Fee Distributor")]),e._v(" "),o("p",[e._v("If you aren't planning to opt into the "),o("RouterLink",{attrs:{to:"/guides/redstone/whats-new.html#smoothing-pool"}},[e._v("Smoothing Pool")]),e._v(" and claim all of your priority fees and MEV rewards to your "),o("RouterLink",{attrs:{to:"/guides/redstone/whats-new.html#fee-recipients-and-your-distributor"}},[e._v("fee distributor contract")]),e._v(", you will eventually have to initialize it (create the contract instance on the chain) in order to claim rewards from it to your withdrawal address.")],1),e._v(" "),o("p",[e._v("This is a fairly cheap operation and only needs to be done once.")]),e._v(" "),o("div",{staticClass:"custom-block tip"},[o("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),o("p",[e._v("Initializing your fee distributor can be done at "),o("strong",[e._v("any time")]),e._v(".\nYou can let rewards accumulate in its address long before you initialize it, and your balance will remain after initialization.")]),e._v(" "),o("p",[e._v("We recommend you do so when gas prices are low to minimize the overhead cost.")]),e._v(" "),o("p",[e._v("Note that it "),o("strong",[e._v("must be initialized in order to claim your rewards.")])])]),e._v(" "),o("h3",{attrs:{id:"opt-into-the-smoothing-pool"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#opt-into-the-smoothing-pool"}},[e._v("#")]),e._v(" Opt Into the Smoothing Pool")]),e._v(" "),o("p",[e._v("If you plan on taking advantage of the "),o("RouterLink",{attrs:{to:"/guides/redstone/whats-new.html#smoothing-pool"}},[e._v("Smoothing Pool")]),e._v(' right away, you should opt in before the end of the first Redstone rewards period to maximize your "eligibility" amount.')],1),e._v(" "),o("p",[e._v("Opting in can be done via running the following command:")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("rocketpool node join-smoothing-pool\n")])])]),o("h3",{attrs:{id:"claim-rewards"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#claim-rewards"}},[e._v("#")]),e._v(" Claim Rewards")]),e._v(" "),o("p",[e._v("The Redstone upgrade replaces the expensive, problematic old rewards system with a "),o("RouterLink",{attrs:{to:"/guides/redstone/whats-new.html#new-rewards-system"}},[e._v("brand new one")]),e._v(" that's much cheaper, supports automatic restaking of RPL (both partial and full amounts), and - most importantly - "),o("strong",[e._v("lets you claim your rewards whenever you want")]),e._v(".")],1),e._v(" "),o("p",[e._v("Because there is no longer a time limit on claiming rewards, and because it's cheaper to claim many rewards intervals at once, the automatic rewards claiming feature of the Smartnode "),o("strong",[e._v("has been removed")]),e._v(".\nYou will now be able to claim rewards via the following command:")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("rocketpool node claim-rewards\n")])])]),o("p",[e._v("This will show you all of the rewards you've accumulated across all of the rewards intervals starting with the Redstone upgrade.")]),e._v(" "),o("h2",{attrs:{id:"reverting-to-v1-4-3"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#reverting-to-v1-4-3"}},[e._v("#")]),e._v(" Reverting to v1.4.3")]),e._v(" "),o("p",[e._v("If, for any reason, something isn't to your liking and you want to revert to the previous Smartnode release, you can do so easily.\nThe Smartnode automatically backs up your settings from the previous version when you upgrade it, so simply get the previous version (here we're demonstrating "),o("strong",[e._v("v1.4.3")]),e._v(") and replace the settings with the backup:")]),e._v(" "),o("ol",[o("li",[e._v("Stop the service:")])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("rocketpool service stop\n")])])]),o("ol",[o("li",[o("p",[e._v("Download the v1.4.3 CLI:")]),e._v(" "),o("Tabs",{attrs:{type:"border-card"}},[o("Tab",{attrs:{label:"Linux x64"}},[o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("wget https://github.com/rocket-pool/smartnode-install/releases/download/v1.4.3/rocketpool-cli-linux-amd64 -O ~/bin/rocketpool\n")])])])]),e._v(" "),o("Tab",{attrs:{label:"Linux arm64"}},[o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("wget https://github.com/rocket-pool/smartnode-install/releases/download/v1.4.3/rocketpool-cli-linux-arm64 -O ~/bin/rocketpool\n")])])])]),e._v(" "),o("Tab",{attrs:{label:"Mac x64"}},[o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("curl -L https://github.com/rocket-pool/smartnode-install/releases/download/v1.4.3/rocketpool-cli-darwin-amd64 > /usr/local/bin/rocketpool\n")])])])]),e._v(" "),o("Tab",{attrs:{label:"Mac arm64"}},[o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("curl -L https://github.com/rocket-pool/smartnode-install/releases/download/v1.4.3/rocketpool-cli-darwin-arm64 > /usr/local/bin/rocketpool\n")])])])])],1)],1),e._v(" "),o("li",[o("p",[e._v("Install the v1.4.3 package:")])])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("rocketpool service install -d\n")])])]),o("ol",[o("li",[e._v("Replace your old configuration with the v1.4.3 backup configuration:")])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("cp ~/.rocketpool/user-settings-backup.yml ~/.rocketpool/user-settings.yml\n")])])]),o("ol",[o("li",[e._v("Verify all of your old settings are now being used:")])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("rocketpool service config\n")])])]),o("ol",[o("li",[e._v("If it looks good, start the Smartnode stack:")])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("rocketpool service start\n")])])]),o("p",[e._v("All set! You're now back on the old version and should begin attesting shortly after starting the service.")]),e._v(" "),o("div",{staticClass:"custom-block danger"},[o("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),o("p",[e._v("v1.4.3 is "),o("strong",[e._v("deprecated")]),e._v(" and will no longer be usable after the Redstone update is deployed.\nIf you do need to revert to it, please make plans to upgrade back to v1.5.0 before the contracts are updated!")])])])}),[],!1,null,null,null);t.default=n.exports}}]);